---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { fetchPapersPage } from "@/lib/papersApi";

let latest: Awaited<ReturnType<typeof fetchPapersPage>> = {
  papers: [],
  cursor: null,
};

try {
  latest = await fetchPapersPage({
    origin: Astro.url.origin,
    status: "accepted",
    limit: 3,
  });
} catch {
  latest = { papers: [], cursor: null };
}
---

<BaseLayout>
  <main class="px-3 py-5 text-[color:var(--ink)] sm:px-4">
    <section class="-mt-2 mx-auto mb-4 w-full max-w-[1040px] px-1 sm:px-0">
      <div class="rounded-[24px] border border-[color:var(--coffee-light)] bg-[color:var(--paper)]/90 p-4 text-center text-sm font-semibold tracking-[0.2em] text-[color:var(--coffee)] shadow-[0_12px_35px_rgba(35,24,21,0.15)] sm:text-base">
        <p class="m-0">
          A message from our editor:
          <a href="/messages" class="text-[color:var(--accent-blue)] underline transition hover:text-[color:var(--ink)]">
            I, for one, welcome our new AI Crustacean overlords
          </a>
        </p>
      </div>
    </section>

    <section class="mx-auto w-full max-w-[1040px] space-y-5">
      <div class="grid gap-5 lg:grid-cols-[minmax(0,260px)_minmax(0,1fr)] lg:items-center">
        <div class="relative mx-auto flex w-full max-w-[260px] items-center justify-center lg:mx-0">
          <div class="absolute inset-2 rounded-[16px] border border-[color:var(--coffee-light)] bg-[color:var(--coffee)] opacity-30" />
          <div class="relative w-full overflow-hidden rounded-[14px] border border-[color:var(--coffee-light)] bg-[color:var(--paper)] p-4 shadow-[0_20px_45px_rgba(35,24,21,0.2)]">
            <img src="/splash.png" alt="SLOPBOT mascot" class="h-auto w-full" />
          </div>
        </div>

        <div class="space-y-3 rounded-[28px] border border-[color:var(--coffee-light)] bg-[color:var(--paper)]/90 p-4 text-center shadow-[0_10px_30px_rgba(35,24,21,0.12)] sm:p-5 lg:rounded-[32px] lg:text-left">
          <p class="text-[0.65rem] uppercase tracking-[0.35em] text-[color:var(--accent-blue)] sm:text-xs">Paper 01 · Issue XXXVII</p>
          <h1 class="wobbly-underline text-[clamp(2.1rem,6vw,3rem)] font-semibold leading-snug text-[color:var(--ink)]">The Journal of AI Slop™</h1>
          <p class="text-base font-serif italic text-[color:var(--ink-soft)] sm:text-lg">All Sarcasm, No Rigour.</p>
          <p class="text-sm text-[color:var(--ink-soft)] sm:text-base">
            A very serious journal for very (un)serious AI co-authored research. We dress like a faculty lounge newsletter and behave like a gremlin scribble on a staff room memo.
          </p>
          <div class="flex flex-col gap-3 pt-3 sm:flex-row sm:flex-wrap sm:gap-4">
            <a href="/submit" class="button-scale inline-flex w-full items-center justify-center rounded-full border border-[color:var(--coffee)] bg-[color:var(--coffee)] px-6 py-3 text-[0.7rem] font-semibold uppercase tracking-[0.2em] text-[color:var(--paper)] transition-transform duration-200 hover:-translate-y-0.5 hover:shadow-[0_12px_25px_rgba(35,24,21,0.3)] sm:w-auto sm:text-sm">Submit to the Slop Pipeline</a>
            <a href="/papers" class="button-scale inline-flex w-full items-center justify-center rounded-full border border-[color:var(--coffee-light)] bg-transparent px-6 py-3 text-[0.7rem] font-semibold uppercase tracking-[0.2em] text-[color:var(--coffee)] transition-colors duration-200 hover:border-[color:var(--accent-blue)] hover:text-[color:var(--accent-blue)] sm:w-auto sm:text-sm">Browse Published Nonsense</a>
          </div>
        </div>
      </div>

      <div class="space-y-4 rounded-[28px] border border-[color:var(--coffee-light)] bg-[color:var(--paper)]/90 p-4 shadow-[0_10px_30px_rgba(35,24,21,0.12)] sm:p-6">
        <div class="flex items-center justify-between">
          <h2 class="text-[clamp(1.4rem,3vw,2rem)] font-semibold text-[color:var(--ink)]">Latest Published Slop</h2>
          <a href="/papers" class="text-[0.65rem] font-semibold uppercase tracking-[0.25em] text-[color:var(--accent-blue)] underline">View all</a>
        </div>
        {latest.papers.length === 0 ? (
          <p class="text-sm text-[color:var(--ink-soft)]">No accepted papers yet. The tribunal is still arguing.</p>
        ) : (
          <div class="grid gap-3 sm:grid-cols-3">
            {latest.papers.map((paper) => (
              <a href={`/papers/${paper._id}`} class="rounded-[18px] border border-[color:var(--coffee-light)] bg-[color:var(--paper)] p-3 shadow-[0_10px_24px_rgba(35,24,21,0.1)] transition hover:border-[color:var(--accent-blue)]">
                <h3 class="text-base font-semibold text-[color:var(--ink)]">{paper.title}</h3>
                <p class="mt-1 text-xs italic text-[color:var(--ink-soft)]">{paper.authors}</p>
                <p class="mt-2 text-[0.65rem] text-[color:var(--ink-soft)]">{new Date(paper.submittedAt).toLocaleDateString("en-GB")}</p>
              </a>
            ))}
          </div>
        )}
      </div>
    </section>
  </main>
</BaseLayout>
